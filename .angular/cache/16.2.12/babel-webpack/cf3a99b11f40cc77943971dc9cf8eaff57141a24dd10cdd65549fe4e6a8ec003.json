{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/jucie/Downloads/ioniclivrodoharrypotter/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport * as i0 from \"@angular/core\";\nexport let DatabaseService = /*#__PURE__*/(() => {\n  class DatabaseService {\n    constructor() {\n      this.storageKey = 'harryPotterFavorites';\n      this.isInitialized = false;\n    }\n    initializeDatabase() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        try {\n          if (!localStorage.getItem(_this.storageKey)) {\n            localStorage.setItem(_this.storageKey, JSON.stringify([]));\n          }\n          _this.isInitialized = true;\n          return true;\n        } catch (error) {\n          _this.isInitialized = false;\n          throw new Error('Failed to initialize database');\n        }\n      })();\n    }\n    addFavorite(book) {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        if (!_this2.isInitialized) {\n          yield _this2.initializeDatabase();\n        }\n        try {\n          const favorites = yield _this2.getFavorites();\n          if (!favorites.some(f => f.number === book.number)) {\n            const sanitizedBook = _this2.sanitizeBook(book);\n            favorites.push(sanitizedBook);\n            localStorage.setItem(_this2.storageKey, JSON.stringify(favorites));\n            return true;\n          }\n          return false;\n        } catch (error) {\n          throw new Error('Failed to add favorite');\n        }\n      })();\n    }\n    getFavorites() {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        if (!_this3.isInitialized) {\n          yield _this3.initializeDatabase();\n        }\n        try {\n          const json = localStorage.getItem(_this3.storageKey);\n          if (!json) return [];\n          const parsed = JSON.parse(json);\n          return Array.isArray(parsed) ? parsed : [];\n        } catch (error) {\n          localStorage.removeItem(_this3.storageKey);\n          return [];\n        }\n      })();\n    }\n    removeFavorite(bookNumber) {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        if (!_this4.isInitialized) {\n          yield _this4.initializeDatabase();\n        }\n        try {\n          const favorites = yield _this4.getFavorites();\n          const filtered = favorites.filter(f => f.number !== bookNumber);\n          localStorage.setItem(_this4.storageKey, JSON.stringify(filtered));\n          return true;\n        } catch (error) {\n          throw new Error('Failed to remove favorite');\n        }\n      })();\n    }\n    sanitizeBook(book) {\n      return {\n        ...book,\n        originalTitle: book.originalTitle?.replace(/[<>\"'&]/g, '') || '',\n        description: book.description?.replace(/[<>\"'&]/g, '') || ''\n      };\n    }\n    static {\n      this.ɵfac = function DatabaseService_Factory(t) {\n        return new (t || DatabaseService)();\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: DatabaseService,\n        factory: DatabaseService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return DatabaseService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}